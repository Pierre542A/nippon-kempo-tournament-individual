import{Y as T,Z as z,r as u,ak as N,b as j,J as B,_ as F,$ as o,a1 as r,a6 as Q,a5 as U,a0 as a,a8 as M,ac as D,ad as d,ae as n,ah as O,a2 as v,aa as J,a3 as _,a4 as q,ax as G,al as V}from"./index-DRsz5w2d.js";import{Q as W}from"./QBanner-DIkF7s1T.js";import{b as E,Q as Y,a as Z}from"./QTable-CR_Qw671.js";import{Q as $}from"./QTooltip-BeCuxwp4.js";import{Q as H}from"./QPage-D-rMEcpj.js";import{u as K}from"./use-quasar-BkUvSKY7.js";import{Q as X}from"./QForm-Cx9K0l2g.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QList-Myhhz7id.js";import"./QSelect-BQUXwyF1.js";const le={class:"row justify-center"},ae={key:0,class:"col-12 col-md-8 col-lg-6"},te={class:"row q-col-gutter-md"},oe={class:"col-12 col-sm-7"},se={class:"col-12 col-sm-5"},re={class:"row justify-end q-mt-lg"},ie={key:1,class:"col-12 col-md-8 col-lg-6 text-center"},ne={class:"q-mb-lg"},ue={class:"col-12 q-mt-xl"},de={class:"row q-mb-md"},ce={class:"col-12 col-md-6"},me={class:"col-12 col-md-6 q-pt-sm-xs q-pt-md-none text-center text-md-right"},ve={class:"full-width row flex-center q-gutter-sm q-pa-lg"},pe=T({__name:"CreateClubPage",setup(be){const c=K(),C=N(),k=z(),y=u(null);(!k.connected||!k.isAdmin)&&(C.push("/"),c.notify({color:"negative",message:"Accès non autorisé",position:"top"}));const i=u(!1),w=u(!1),p=u(""),x=u([]),b=u(""),f=u("all"),g=u(null),A=[{name:"id",required:!0,label:"ID",align:"left",field:"id",sortable:!0,style:"width: 50px"},{name:"name",required:!0,label:"Nom",align:"left",field:"name",sortable:!0},{name:"email",required:!0,label:"Email",align:"left",field:"email",sortable:!0},{name:"phone",required:!0,label:"Téléphone",align:"left",field:"phone"},{name:"city",required:!0,label:"Ville",align:"left",field:"city",sortable:!0},{name:"status",required:!0,label:"Statut",align:"center",field:"is_active",sortable:!0},{name:"actions",required:!0,label:"Actions",align:"center",field:"actions"}],s=u({name:"",email:"",phone:"",website:"",street:"",city:"",postal_code:"",is_active:!0}),I=j(()=>{let t=x.value;if(f.value==="active"?t=t.filter(l=>l.is_active):f.value==="inactive"&&(t=t.filter(l=>!l.is_active)),b.value){const l=b.value.toLowerCase();t=t.filter(e=>e.name.toLowerCase().includes(l)||e.email.toLowerCase().includes(l)||e.city.toLowerCase().includes(l))}return t});async function P(){i.value=!0;try{const l=await fetch("undefined/clubs",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s.value)}),e=await l.json();if(!l.ok)throw new Error(e.error||"Erreur lors de la création du club");const m=e.club_id||"";p.value=`Le club "${s.value.name}" a été créé avec succès ! ${m?`(ID: ${m})`:""}`,c.notify({color:"positive",message:"Club créé avec succès",icon:"check_circle",position:"top",timeout:2e3}),L(),h()}catch(t){let l="Erreur lors de la création du club";t instanceof Error&&(l=t.message),c.notify({color:"negative",message:l,icon:"error",position:"top",timeout:4e3}),console.error("Erreur lors de la création du club:",t)}finally{i.value=!1}}function L(){s.value={name:"",email:"",phone:"",website:"",street:"",city:"",postal_code:"",is_active:!0},p.value="",y.value&&y.value.resetValidation()}async function h(){w.value=!0;try{const l=await fetch("undefined/clubs?show_all=true",{credentials:"include"});if(!l.ok)throw new Error("Erreur lors de la récupération des clubs");const e=await l.json();x.value=e.clubs||[]}catch(t){console.error("Erreur lors de la récupération des clubs:",t),c.notify({color:"negative",message:"Erreur lors du chargement des clubs",icon:"error",position:"top"})}finally{w.value=!1}}async function R(t){g.value=t.id;try{const e=await fetch(`undefined/clubs/${t.id}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_active:!t.is_active})});if(!e.ok){const m=await e.json();throw new Error(m.error||`Erreur lors de la ${t.is_active?"désactivation":"activation"} du club`)}t.is_active=!t.is_active,c.notify({color:"positive",message:`Club ${t.is_active?"activé":"désactivé"} avec succès`,icon:"check_circle",position:"top",timeout:2e3})}catch(l){let e=`Erreur lors de la ${t.is_active?"désactivation":"activation"} du club`;l instanceof Error&&(e=l.message),c.notify({color:"negative",message:e,icon:"error",position:"top",timeout:4e3}),console.error("Erreur lors de la modification du statut du club:",l),await h()}finally{g.value=null}}function S(t){C.push(`/admin/edit-club/${t.id}`)}return B(()=>{h()}),(t,l)=>(V(),F(H,{padding:""},{default:o(()=>[r("div",le,[p.value?U("",!0):(V(),Q("div",ae,[l[11]||(l[11]=r("div",{class:"text-h4 q-mb-lg text-center"},"Créer un nouveau club",-1)),a(J,{class:"club-form-card q-pa-md"},{default:o(()=>[a(M(X),{ref_key:"clubForm",ref:y,onSubmit:D(P,["prevent"]),class:"q-gutter-md"},{default:o(()=>[l[9]||(l[9]=r("div",{class:"text-subtitle1 q-mb-sm"},"Informations générales",-1)),a(d,{modelValue:s.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value.name=e),label:"Nom du club *",outlined:"",rules:[e=>!!e||"Le nom est requis"],disable:i.value,"lazy-rules":""},{prepend:o(()=>[a(n,{name:"badge",color:"primary"})]),_:1},8,["modelValue","rules","disable"]),a(d,{modelValue:s.value.email,"onUpdate:modelValue":l[1]||(l[1]=e=>s.value.email=e),label:"Email *",type:"email",outlined:"",rules:[e=>!!e||"L'email est requis",e=>/^[^@]+@[^@]+\.[^@]+$/.test(e)||"Format d'email invalide"],disable:i.value,"lazy-rules":""},{prepend:o(()=>[a(n,{name:"email",color:"primary"})]),_:1},8,["modelValue","rules","disable"]),a(d,{modelValue:s.value.phone,"onUpdate:modelValue":l[2]||(l[2]=e=>s.value.phone=e),label:"Téléphone *",outlined:"",rules:[e=>!!e||"Le téléphone est requis"],disable:i.value,"lazy-rules":""},{prepend:o(()=>[a(n,{name:"phone",color:"primary"})]),_:1},8,["modelValue","rules","disable"]),a(d,{modelValue:s.value.website,"onUpdate:modelValue":l[3]||(l[3]=e=>s.value.website=e),label:"Site Web",outlined:"",rules:[e=>!e||/^https?:\/\/.+/.test(e)||"URL invalide"],disable:i.value,"lazy-rules":""},{prepend:o(()=>[a(n,{name:"language",color:"primary"})]),_:1},8,["modelValue","rules","disable"]),a(O),l[10]||(l[10]=r("div",{class:"text-subtitle1 q-mb-sm"},"Adresse",-1)),a(d,{modelValue:s.value.street,"onUpdate:modelValue":l[4]||(l[4]=e=>s.value.street=e),label:"Rue *",outlined:"",rules:[e=>!!e||"L'adresse est requise"],disable:i.value,class:"q-mb-md","lazy-rules":""},{prepend:o(()=>[a(n,{name:"home",color:"primary"})]),_:1},8,["modelValue","rules","disable"]),r("div",te,[r("div",oe,[a(d,{modelValue:s.value.city,"onUpdate:modelValue":l[5]||(l[5]=e=>s.value.city=e),label:"Ville *",outlined:"",rules:[e=>!!e||"La ville est requise"],disable:i.value,"lazy-rules":""},{prepend:o(()=>[a(n,{name:"location_city",color:"primary"})]),_:1},8,["modelValue","rules","disable"])]),r("div",se,[a(d,{modelValue:s.value.postal_code,"onUpdate:modelValue":l[6]||(l[6]=e=>s.value.postal_code=e),label:"Code postal *",outlined:"",rules:[e=>!!e||"Le code postal est requis"],disable:i.value,"lazy-rules":""},{prepend:o(()=>[a(n,{name:"markunread_mailbox",color:"primary"})]),_:1},8,["modelValue","rules","disable"])])]),r("div",re,[a(v,{flat:"",label:"Annuler",color:"grey-7",to:"/admin",disable:i.value,class:"q-mr-sm"},null,8,["disable"]),a(v,{unelevated:"",type:"submit",label:"Créer le club",color:"primary",loading:i.value,icon:"add_business"},null,8,["loading"])])]),_:1},512)]),_:1})])),p.value?(V(),Q("div",ie,[a(W,{class:"bg-positive text-white q-mb-lg"},{avatar:o(()=>[a(n,{name:"check_circle"})]),default:o(()=>[_(" "+q(p.value),1)]),_:1}),r("div",ne,[a(v,{color:"primary",label:"Retour à l'administration",to:"/admin",icon:"arrow_back",class:"q-mr-sm"}),a(v,{color:"secondary",label:"Créer un autre club",onClick:L,icon:"refresh"})])])):U("",!0),r("div",ue,[l[14]||(l[14]=r("h4",{class:"text-center"},"Liste des clubs",-1)),r("div",de,[r("div",ce,[a(d,{modelValue:b.value,"onUpdate:modelValue":l[7]||(l[7]=e=>b.value=e),placeholder:"Rechercher un club...",dense:"",outlined:""},{append:o(()=>[a(n,{name:"search"})]),_:1},8,["modelValue"])]),r("div",me,[a(G,{modelValue:f.value,"onUpdate:modelValue":l[8]||(l[8]=e=>f.value=e),options:[{label:"Tous",value:"all"},{label:"Actifs",value:"active"},{label:"Inactifs",value:"inactive"}],inline:"",dense:"",color:"primary"},null,8,["modelValue"])])]),a(Z,{rows:I.value,loading:w.value,columns:A,"row-key":"id",pagination:{rowsPerPage:10},separator:"cell",class:"q-mt-md club-table"},{"body-cell-status":o(e=>[a(E,{props:e},{default:o(()=>[a(Y,{color:e.row.is_active?"positive":"negative"},{default:o(()=>[_(q(e.row.is_active?"Actif":"Inactif"),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-actions":o(e=>[a(E,{props:e,class:"q-gutter-sm"},{default:o(()=>[a(v,{flat:"",round:"",size:"sm",color:e.row.is_active?"negative":"positive",icon:e.row.is_active?"block":"check_circle",onClick:m=>R(e.row),disable:g.value===e.row.id,loading:g.value===e.row.id},{default:o(()=>[a($,null,{default:o(()=>[_(q(e.row.is_active?"Désactiver":"Activer"),1)]),_:2},1024)]),_:2},1032,["color","icon","onClick","disable","loading"]),a(v,{flat:"",round:"",size:"sm",color:"primary",icon:"edit",onClick:m=>S(e.row)},{default:o(()=>[a($,null,{default:o(()=>l[12]||(l[12]=[_("Modifier")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),"no-data":o(()=>[r("div",ve,[a(n,{name:"business",size:"2em",color:"grey-7"}),l[13]||(l[13]=r("span",{class:"text-grey-7"}," Aucun club trouvé ",-1))])]),_:1},8,["rows","loading"])])])]),_:1}))}}),xe=ee(pe,[["__scopeId","data-v-7539e975"]]);export{xe as default};
