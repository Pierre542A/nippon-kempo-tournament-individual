import{Q as de}from"./QImg-Bpmswd2f.js";import{Y as ce,Z as fe,r as m,b as _,w as me,J as _e,_ as C,$ as t,an as T,I as pe,aj as ve,al as b,a1 as l,a6 as D,a5 as $,a0 as e,ao as ge,a4 as o,a2 as q,aa as v,ab as p,a3 as s,a8 as B,ai as E,ap as U,aq as A,ah as R,ae as H,a9 as be,ag as he,K as O}from"./index-DRsz5w2d.js";import{e as d,f as c,d as i}from"./QSelect-BQUXwyF1.js";import{Q as P}from"./QList-Myhhz7id.js";import{Q as j,a as we,b as g}from"./QTable-CR_Qw671.js";import{Q as ye}from"./QTr-Bc9BNqo7.js";import{Q as ke}from"./QPage-D-rMEcpj.js";import{C as F}from"./ClosePopup-D3O_dCn1.js";import{u as qe}from"./use-quasar-BkUvSKY7.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Qe={class:"row justify-center q-mb-xl"},Ce={class:"column items-center"},Te={class:"q-mt-md text-weight-bold"},De={class:"row q-col-gutter-lg"},Pe={class:"col-12 col-md-4"},Ke={class:"col-12 col-md-8"},Ie={class:"row q-col-gutter-md q-mt-sm"},Se={class:"text-h4"},Le={class:"stat-label"},Me=["innerHTML"],Ne={class:"row q-col-gutter-md q-mt-sm"},Ve={class:"text-h4"},$e={class:"stat-label"},Be=["innerHTML"],Ee={key:0,class:"row q-mt-xl"},Ue={class:"col-12"},Ae={class:"row justify-between items-center"},Re={class:"row q-col-gutter-md"},He={class:"col-12 col-md-6"},Oe={class:"col-12 col-md-6"},je={class:"row q-mt-md"},Fe={class:"col-12 text-center"},ze={class:"row q-mt-xl"},Ge={class:"col-12"},Je={class:"full-width row flex-center q-py-md"},Ye={class:"text-h6"},Ze=ce({__name:"ProfilePage",setup(We){const r=fe(),h=qe(),z=ve(),G=m(!1),K=m(0),J=_(()=>r.fullName),Y=_(()=>r.user?.email??"—"),Z=_(()=>r.user?.phone??"—"),W=_(()=>r.user?.birth_date?new Date(r.user.birth_date).toLocaleDateString("fr-FR"):"—"),X=_(()=>r.user?.grade_name??"—"),ee=_(()=>r.user?.club_name??"—"),I=_(()=>r.stats??{totalTournaments:0,victories:0,defeats:0,matches:0,ippon:0,keiKoku:0}),te=["totalTournaments","victories","defeats"],ae=["matches","ippon","keiKoku"],x={totalTournaments:"Tournois participés",victories:"Victoires (tous matchs cumulés)",defeats:"Défaites (tous matchs cumulés)",matches:"Matchs participés",ippon:"IPPON marqués (tous matchs cumulés)",keiKoku:"KEI-KOKU reçus (tous matchs cumulés)"},S={totalTournaments:"bg-primary",victories:"bg-positive",defeats:"bg-negative",matches:"bg-secondary",ippon:"bg-deep-purple",keiKoku:"bg-orange"};function L(u){return x[u].includes("(tous")?x[u].replace(" (tous matchs cumulés)","<br>(tous matchs cumulés)"):x[u]}const le=_(()=>r.avatarUrl),f=m(null),M=m([]),Q=m(!1),se=m({rowsPerPage:5,sortBy:"start_date",descending:!0}),ne=[{name:"tournament",label:"Tournoi",field:"tournament_name",align:"left",sortable:!0,required:!0},{name:"start_date",label:"Début",field:"start_date",align:"left",sortable:!0,required:!0},{name:"end_date",label:"Fin",field:"end_date",align:"left",sortable:!0,required:!0},{name:"placement",label:"Classement",field:"placement",align:"center",sortable:!0,required:!0},{name:"participants",label:"Participants",field:"participants",align:"left",sortable:!1,required:!0},{name:"ippon",label:"IPPON",field:"ippon",align:"center",sortable:!0,required:!0},{name:"keikoku",label:"KEI-KOKU",field:"keikoku",align:"center",sortable:!0,required:!0}],w=m(!1),y=m(!1);function k(u){return u?new Date(u).toLocaleDateString("fr-FR",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}):"—"}async function oe(){if(r.user?.id){Q.value=!0;try{const{data:u}=await T.get(`undefined/users/${r.user.id}/matches`);M.value=u.matches.map(a=>({id:a.id,tournament_name:a.tournament_name,start_date:a.start_date,end_date:a.end_date,placement:a.placement??null,participants:`${r.fullName} vs ${a.opponent_name}`,ippon:a.ippon,keikoku:a.keikoku}))}catch{console.error("fetchMatches"),h.notify({color:"negative",message:"Erreur lors du chargement des matches",icon:"error"})}finally{Q.value=!1}}}async function ie(){if(r.user?.id_tournament_waiting)try{const{data:u}=await T.get(`undefined/tournaments/${r.user.id_tournament_waiting}`);f.value=u}catch{h.notify({color:"negative",message:"Erreur lors de la récupération du tournoi",icon:"error"})}}function re(){w.value=!0}async function ue(){if(r.user?.id){y.value=!0;try{await T.delete(`undefined/users/${r.user.id}/tournament-registration`),r.user.id_tournament_waiting=null,f.value=null,h.notify({color:"positive",message:"Désinscription effectuée",icon:"check_circle"})}catch{h.notify({color:"negative",message:"Erreur lors de la désinscription",icon:"error"})}finally{y.value=!1,w.value=!1}}}const N=m(!1);async function V(){N.value=!0;try{await r.fetchSession(),K.value++,await pe()}finally{N.value=!1}}return me(()=>z.fullPath,async(u,a)=>{u.includes("/profile")&&a?.includes("/profile/edit")&&await V()}),_e(async()=>{await V(),await oe(),await ie()}),(u,a)=>(b(),C(ke,{class:"q-pa-lg"},{default:t(()=>[l("div",Qe,[l("div",Ce,[e(ge,{size:"150px",class:"shadow-5"},{default:t(()=>[(b(),C(de,{src:le.value,key:K.value},null,8,["src"]))]),_:1}),l("h1",Te,o(J.value),1),e(q,{to:"/profile/edit",color:"primary",label:"Modifier mon profil",class:"q-mt-sm",icon:"edit"})])]),l("div",De,[l("div",Pe,[e(v,{flat:"",bordered:"",class:"full-height"},{default:t(()=>[e(p,null,{default:t(()=>[a[7]||(a[7]=l("div",{class:"text-h6"},"Informations personnelles",-1)),e(P,null,{default:t(()=>[e(d,null,{default:t(()=>[e(c,null,{default:t(()=>[e(i,{caption:""},{default:t(()=>a[1]||(a[1]=[s("Email")])),_:1}),e(i,null,{default:t(()=>[s(o(Y.value),1)]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,null,{default:t(()=>[e(i,{caption:""},{default:t(()=>a[2]||(a[2]=[s("Téléphone")])),_:1}),e(i,null,{default:t(()=>[s(o(Z.value),1)]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,null,{default:t(()=>[e(i,{caption:""},{default:t(()=>a[3]||(a[3]=[s("Date de naissance")])),_:1}),e(i,null,{default:t(()=>[s(o(W.value),1)]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,null,{default:t(()=>[e(i,{caption:""},{default:t(()=>a[4]||(a[4]=[s("Grade")])),_:1}),e(i,null,{default:t(()=>[s(o(X.value),1)]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,null,{default:t(()=>[e(i,{caption:""},{default:t(()=>a[5]||(a[5]=[s("Club")])),_:1}),e(i,null,{default:t(()=>[s(o(ee.value),1)]),_:1})]),_:1})]),_:1}),G.value?(b(),C(d,{key:0},{default:t(()=>[e(c,null,{default:t(()=>[e(i,{caption:""},{default:t(()=>a[6]||(a[6]=[s("Avatar Seed")])),_:1}),e(i,null,{default:t(()=>[s(o(B(r).user?.avatar_seed||"default"),1)]),_:1})]),_:1})]),_:1})):$("",!0)]),_:1})]),_:1})]),_:1})]),l("div",Ke,[e(v,{flat:"",bordered:"",class:"full-height"},{default:t(()=>[e(p,null,{default:t(()=>[a[8]||(a[8]=l("div",{class:"text-h6"},"Statistiques",-1)),l("div",Ie,[(b(),D(E,null,U(te,n=>l("div",{key:n,class:"col-6 col-sm-4"},[e(v,{flat:"",class:A(S[n]+" text-white stat-card")},{default:t(()=>[e(p,{class:"text-center"},{default:t(()=>[l("div",Se,o(I.value[n]),1),l("div",Le,[l("span",{innerHTML:L(n)},null,8,Me)])]),_:2},1024)]),_:2},1032,["class"])])),64))]),l("div",Ne,[(b(),D(E,null,U(ae,n=>l("div",{key:n,class:"col-6 col-sm-4"},[e(v,{flat:"",class:A(S[n]+" text-white stat-card")},{default:t(()=>[e(p,{class:"text-center"},{default:t(()=>[l("div",Ve,o(I.value[n]),1),l("div",$e,[l("span",{innerHTML:L(n)},null,8,Be)])]),_:2},1024)]),_:2},1032,["class"])])),64))])]),_:1})]),_:1})])]),B(r).user?.id_tournament_waiting?(b(),D("div",Ee,[l("div",Ue,[e(v,{flat:"",bordered:""},{default:t(()=>[e(p,null,{default:t(()=>[l("div",Ae,[a[9]||(a[9]=l("div",{class:"text-h6"},"Tournoi en attente d'inscription",-1)),e(q,{color:"negative",label:"Se désinscrire",icon:"cancel",unelevated:"",onClick:re,loading:y.value},null,8,["loading"])]),e(R,{class:"q-my-md"}),l("div",Re,[l("div",He,[e(P,{dense:""},{default:t(()=>[e(d,null,{default:t(()=>[e(c,null,{default:t(()=>[e(i,{caption:""},{default:t(()=>a[10]||(a[10]=[s("Nom du tournoi")])),_:1}),e(i,{class:"text-bold"},{default:t(()=>[s(o(f.value?.name||"Chargement..."),1)]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,null,{default:t(()=>[e(i,{caption:""},{default:t(()=>a[11]||(a[11]=[s("Date de début")])),_:1}),e(i,null,{default:t(()=>[s(o(k(f.value?.start_date)),1)]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,null,{default:t(()=>[e(i,{caption:""},{default:t(()=>a[12]||(a[12]=[s("Date de fin")])),_:1}),e(i,null,{default:t(()=>[s(o(k(f.value?.end_date)),1)]),_:1})]),_:1})]),_:1})]),_:1})]),l("div",Oe,[e(P,{dense:""},{default:t(()=>[e(d,null,{default:t(()=>[e(c,null,{default:t(()=>[e(i,{caption:""},{default:t(()=>a[13]||(a[13]=[s("Lieu")])),_:1}),e(i,null,{default:t(()=>[s(o(f.value?.address||"—"),1)]),_:1})]),_:1})]),_:1}),e(d,null,{default:t(()=>[e(c,null,{default:t(()=>[e(i,{caption:""},{default:t(()=>a[14]||(a[14]=[s("Statut")])),_:1}),e(i,null,{default:t(()=>[e(j,{color:f.value?.status==="open"?"positive":"negative"},{default:t(()=>[s(o(f.value?.status==="open"?"Ouvert aux inscriptions":"Inscriptions fermées"),1)]),_:1},8,["color"])]),_:1})]),_:1})]),_:1})]),_:1})])]),l("div",je,[l("div",Fe,[e(j,{color:"orange",class:"q-pa-sm"},{default:t(()=>a[15]||(a[15]=[s("Votre inscription est en attente de validation")])),_:1})])])]),_:1})]),_:1})])])):$("",!0),l("div",ze,[l("div",Ge,[e(v,{flat:"",bordered:""},{default:t(()=>[e(p,null,{default:t(()=>[a[17]||(a[17]=l("div",{class:"text-h6"},"Historique des matches",-1)),e(R,{class:"q-my-md"}),e(we,{rows:M.value,columns:ne,"row-key":"id",loading:Q.value,pagination:se.value,flat:"",bordered:"","rows-per-page-options":[5,10,15]},{body:t(n=>[e(ye,{props:n},{default:t(()=>[e(g,{key:"tournament",props:n},{default:t(()=>[s(o(n.row.tournament_name),1)]),_:2},1032,["props"]),e(g,{key:"start_date",props:n},{default:t(()=>[s(o(k(n.row.start_date)),1)]),_:2},1032,["props"]),e(g,{key:"end_date",props:n},{default:t(()=>[s(o(k(n.row.end_date)),1)]),_:2},1032,["props"]),e(g,{key:"placement",props:n},{default:t(()=>[s(o(n.row.placement??"N/A"),1)]),_:2},1032,["props"]),e(g,{key:"participants",props:n},{default:t(()=>[s(o(n.row.participants),1)]),_:2},1032,["props"]),e(g,{key:"ippon",props:n},{default:t(()=>[s(o(n.row.ippon),1)]),_:2},1032,["props"]),e(g,{key:"keikoku",props:n},{default:t(()=>[s(o(n.row.keikoku),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),"no-data":t(()=>[l("div",Je,[e(H,{name:"emoji_events_off",size:"2em",color:"grey-7",class:"q-mr-sm"}),a[16]||(a[16]=l("span",{class:"text-grey-7"},"Aucun match trouvé",-1))])]),_:1},8,["rows","loading","pagination"])]),_:1})]),_:1})])]),e(be,{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=n=>w.value=n),persistent:""},{default:t(()=>[e(v,{style:{"min-width":"300px"}},{default:t(()=>[e(p,{class:"bg-negative text-white"},{default:t(()=>[l("div",Ye,[e(H,{name:"warning",class:"q-mr-sm"}),a[18]||(a[18]=s("Confirmation de désinscription"))])]),_:1}),e(p,{class:"q-pt-md"},{default:t(()=>[s('Êtes-vous sûr de vouloir vous désinscrire du tournoi "'+o(f.value?.name||"en attente")+'" ?',1),a[19]||(a[19]=l("p",{class:"text-negative q-mt-sm"},"Cette action est irréversible.",-1))]),_:1}),e(he,{align:"right",class:"q-pb-md q-pr-md"},{default:t(()=>[O(e(q,{flat:"",label:"Annuler",color:"primary"},null,512),[[F]]),O(e(q,{unelevated:"",label:"Confirmer",color:"negative",onClick:ue,loading:y.value},null,8,["loading"]),[[F]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),ut=xe(Ze,[["__scopeId","data-v-2b295a95"]]);export{ut as default};
