import{Y as j,Z as z,r as d,ak as R,aj as S,J as $,_ as f,$ as t,a1 as r,a6 as y,a5 as g,aa as k,a0 as a,ad as c,ae as i,ah as A,aw as I,a3 as _,a2 as V,ac as P,a4 as E,al as m,ay as B}from"./index-DRsz5w2d.js";import{Q as N}from"./QForm-Cx9K0l2g.js";import{Q as U}from"./QBanner-DIkF7s1T.js";import{Q as T}from"./QPage-D-rMEcpj.js";import{u as M}from"./use-quasar-BkUvSKY7.js";const F={class:"row justify-center"},D={class:"col-12 col-md-8 col-lg-6"},J={class:"row q-col-gutter-md"},O={class:"col-12 col-sm-7"},W={class:"col-12 col-sm-5"},Y={key:0,class:"text-caption q-ml-md"},Z={class:"row justify-end q-mt-lg"},G={key:2,class:"text-center"},H={key:3,class:"text-center q-mt-lg"},te=j({__name:"EditClubPage",setup(K){const p=M(),w=R(),h=S(),q=z(),Q=d(null);(!q.connected||!q.isAdmin)&&(w.push("/"),p.notify({color:"negative",message:"Accès non autorisé",position:"top"}));const x=d(h.params.id),v=d(!0),o=d(!1),b=d(""),n=d(""),s=d({name:"",email:"",phone:"",website:"",street:"",city:"",postal_code:"",is_active:!0});async function C(){v.value=!0,n.value="";try{const l=await fetch(`undefined/clubs/${x.value}`,{credentials:"include"});if(!l.ok)throw new Error(`Erreur lors de la récupération des données du club (${l.status})`);const e=await l.json();if(!e.club)throw new Error("Club non trouvé");s.value={name:e.club.name||"",email:e.club.email||"",phone:e.club.phone||"",website:e.club.website||"",street:e.club.street||"",city:e.club.city||"",postal_code:e.club.postal_code||"",is_active:e.club.is_active===1||e.club.is_active===!0}}catch(u){console.error("Erreur lors de la récupération des données du club:",u);let l="Erreur lors du chargement des données du club";u instanceof Error&&(l=u.message),n.value=l}finally{v.value=!1}}async function L(){o.value=!0,b.value="",n.value="";try{const l=await fetch(`undefined/clubs/${x.value}`,{method:"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(s.value)}),e=await l.json();if(!l.ok)throw new Error(e.error||"Erreur lors de la mise à jour du club");b.value=`Le club "${s.value.name}" a été mis à jour avec succès !`,p.notify({color:"positive",message:"Club mis à jour avec succès",icon:"check_circle",position:"top",timeout:2e3}),setTimeout(()=>{w.push("/admin/create-club")},2e3)}catch(u){let l="Erreur lors de la mise à jour du club";u instanceof Error&&(l=u.message),n.value=l,p.notify({color:"negative",message:l,icon:"error",position:"top",timeout:4e3}),console.error("Erreur lors de la mise à jour du club:",u)}finally{o.value=!1}}return $(()=>{C()}),(u,l)=>(m(),f(T,{padding:""},{default:t(()=>[r("div",F,[r("div",D,[l[13]||(l[13]=r("div",{class:"text-h4 q-mb-lg text-center"},"Modifier un club",-1)),v.value?(m(),f(k,{key:0,class:"club-form-card q-pa-md text-center"},{default:t(()=>[a(B,{color:"primary",size:"3em"}),l[8]||(l[8]=r("div",{class:"q-mt-md"},"Chargement des données du club...",-1))]),_:1})):n.value?n.value?(m(),y("div",G,[a(U,{class:"bg-negative text-white"},{avatar:t(()=>[a(i,{name:"error"})]),default:t(()=>[_(" "+E(n.value),1)]),_:1}),a(V,{color:"primary",label:"Retour à la liste des clubs",to:"/admin/create-club",icon:"arrow_back",class:"q-mt-md"})])):g("",!0):(m(),f(k,{key:1,class:"club-form-card q-pa-md"},{default:t(()=>[a(N,{ref_key:"clubForm",ref:Q,onSubmit:P(L,["prevent"]),class:"q-gutter-md"},{default:t(()=>[l[10]||(l[10]=r("div",{class:"text-subtitle1 q-mb-sm"},"Informations générales",-1)),a(c,{modelValue:s.value.name,"onUpdate:modelValue":l[0]||(l[0]=e=>s.value.name=e),label:"Nom du club *",outlined:"",rules:[e=>!!e||"Le nom est requis"],disable:o.value,"lazy-rules":""},{prepend:t(()=>[a(i,{name:"badge",color:"primary"})]),_:1},8,["modelValue","rules","disable"]),a(c,{modelValue:s.value.email,"onUpdate:modelValue":l[1]||(l[1]=e=>s.value.email=e),label:"Email *",type:"email",outlined:"",rules:[e=>!!e||"L'email est requis",e=>/^[^@]+@[^@]+\.[^@]+$/.test(e)||"Format d'email invalide"],disable:o.value,"lazy-rules":""},{prepend:t(()=>[a(i,{name:"email",color:"primary"})]),_:1},8,["modelValue","rules","disable"]),a(c,{modelValue:s.value.phone,"onUpdate:modelValue":l[2]||(l[2]=e=>s.value.phone=e),label:"Téléphone *",outlined:"",rules:[e=>!!e||"Le téléphone est requis"],disable:o.value,"lazy-rules":""},{prepend:t(()=>[a(i,{name:"phone",color:"primary"})]),_:1},8,["modelValue","rules","disable"]),a(c,{modelValue:s.value.website,"onUpdate:modelValue":l[3]||(l[3]=e=>s.value.website=e),label:"Site Web",outlined:"",rules:[e=>!e||/^https?:\/\/.+/.test(e)||"URL invalide"],disable:o.value,"lazy-rules":""},{prepend:t(()=>[a(i,{name:"language",color:"primary"})]),_:1},8,["modelValue","rules","disable"]),a(A),l[11]||(l[11]=r("div",{class:"text-subtitle1 q-mb-sm"},"Adresse",-1)),a(c,{modelValue:s.value.street,"onUpdate:modelValue":l[4]||(l[4]=e=>s.value.street=e),label:"Rue *",outlined:"",rules:[e=>!!e||"L'adresse est requise"],disable:o.value,class:"q-mb-md","lazy-rules":""},{prepend:t(()=>[a(i,{name:"home",color:"primary"})]),_:1},8,["modelValue","rules","disable"]),r("div",J,[r("div",O,[a(c,{modelValue:s.value.city,"onUpdate:modelValue":l[5]||(l[5]=e=>s.value.city=e),label:"Ville *",outlined:"",rules:[e=>!!e||"La ville est requise"],disable:o.value,"lazy-rules":""},{prepend:t(()=>[a(i,{name:"location_city",color:"primary"})]),_:1},8,["modelValue","rules","disable"])]),r("div",W,[a(c,{modelValue:s.value.postal_code,"onUpdate:modelValue":l[6]||(l[6]=e=>s.value.postal_code=e),label:"Code postal *",outlined:"",rules:[e=>!!e||"Le code postal est requis"],disable:o.value,"lazy-rules":""},{prepend:t(()=>[a(i,{name:"markunread_mailbox",color:"primary"})]),_:1},8,["modelValue","rules","disable"])])]),l[12]||(l[12]=r("div",{class:"text-subtitle1 q-mb-sm"},"Statut",-1)),a(I,{modelValue:s.value.is_active,"onUpdate:modelValue":l[7]||(l[7]=e=>s.value.is_active=e),label:"Club actif",color:"positive",disable:o.value},null,8,["modelValue","disable"]),s.value.is_active?g("",!0):(m(),y("div",Y,[a(i,{name:"info",color:"warning",size:"xs",class:"q-mr-xs"}),l[9]||(l[9]=_(" Désactiver un club le rendra invisible dans les listes publiques. "))])),r("div",Z,[a(V,{flat:"",label:"Annuler",color:"grey-7",to:"/admin/create-club",disable:o.value,class:"q-mr-sm"},null,8,["disable"]),a(V,{unelevated:"",type:"submit",label:"Enregistrer les modifications",color:"primary",loading:o.value,icon:"save"},null,8,["loading"])])]),_:1},512)]),_:1})),b.value?(m(),y("div",H,[a(U,{class:"bg-positive text-white"},{avatar:t(()=>[a(i,{name:"check_circle"})]),default:t(()=>[_(" "+E(b.value),1)]),_:1})])):g("",!0)])])]),_:1}))}});export{te as default};
