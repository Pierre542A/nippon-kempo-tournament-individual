import{Y as N,r as i,J as R,aj as D,an as V,_ as w,$ as a,a1 as o,a0 as s,a6 as _,a5 as B,ab as r,a3 as h,ae as c,a4 as $,a2 as m,ac as S,ad as k,aa as C,ag as j,K as M,a9 as T,ak as A,al as v}from"./index-DRsz5w2d.js";import{Q as I}from"./QForm-Cx9K0l2g.js";import{Q as F}from"./QPage-D-rMEcpj.js";import{C as J}from"./ClosePopup-D3O_dCn1.js";import{u as K}from"./use-quasar-BkUvSKY7.js";const Y={class:"row justify-center items-start q-pa-md"},G={class:"col-12 col-sm-8 col-md-6 col-lg-4"},H={key:0},O={class:"text-subtitle1 q-mb-sm"},W={class:"q-mb-md"},X={class:"row q-gutter-sm"},Z={key:1},ee={class:"row items-center q-mb-md"},se={class:"text-caption"},re=N({__name:"ResetPasswordPage",setup(ae){const n=K(),Q=D(),z=A(),g=i(""),u=i(""),b=i(""),p=i(!1),d=i(""),q=i(!1),f=i(!1),y=i(""),x=i(!1);function L(){f.value=!0}async function E(){if(!y.value){n.notify({color:"negative",message:"Veuillez entrer votre adresse email"});return}x.value=!0;try{await V.post("undefined/request-password-reset",{email:y.value}),n.notify({color:"positive",message:"Un email de réinitialisation a été envoyé à votre adresse si celle-ci est associée à un compte"}),f.value=!1}catch(l){console.error("Erreur demande de réinitialisation:",l),n.notify({color:"positive",message:"Un email de réinitialisation a été envoyé à votre adresse si celle-ci est associée à un compte"})}finally{x.value=!1,f.value=!1}}async function U(){if(u.value!==b.value){n.notify({color:"negative",message:"Les mots de passe ne correspondent pas"});return}if(u.value.length<8){n.notify({color:"negative",message:"Le mot de passe doit contenir au moins 8 caractères"});return}p.value=!0;try{const l=await V.post("undefined/reset-password",{token:g.value,password:u.value});l.data.success?(q.value=!0,n.notify({color:"positive",message:"Votre mot de passe a été réinitialisé avec succès"})):n.notify({color:"negative",message:l.data.error||"Une erreur est survenue"})}catch(l){console.error("Erreur réinitialisation:",l),n.notify({color:"negative",message:"Une erreur est survenue lors de la réinitialisation du mot de passe"})}finally{p.value=!1}}function P(){z.push("/"),setTimeout(()=>{window.dispatchEvent(new CustomEvent("open-login-dialog"))},100)}return R(async()=>{if(g.value=Q.query.token||"",!g.value){d.value="Lien de réinitialisation invalide. Veuillez demander un nouveau lien.";return}try{p.value=!0,(await V.post("undefined/verify-reset-token",{token:g.value})).data.success||(d.value="Ce lien de réinitialisation a expiré ou est invalide. Veuillez demander un nouveau lien.")}catch(l){console.error("Erreur vérification token:",l),d.value="Ce lien de réinitialisation a expiré ou est invalide. Veuillez demander un nouveau lien."}finally{p.value=!1}}),(l,e)=>(v(),w(F,{class:"flex flex-center"},{default:a(()=>[o("div",Y,[o("div",G,[s(C,{class:"shadow-3 rounded-borders"},{default:a(()=>[s(r,{class:"bg-primary text-white"},{default:a(()=>e[4]||(e[4]=[o("div",{class:"text-h5"},"Réinitialisation de mot de passe",-1)])),_:1}),d.value?(v(),_("div",H,[s(r,{class:"bg-negative text-white q-pb-md"},{default:a(()=>[o("div",O,[s(c,{name:"error",size:"sm",class:"q-mr-xs"}),e[5]||(e[5]=h(" Une erreur est survenue "))]),o("p",W,$(d.value),1),o("div",X,[s(m,{color:"white",outline:"",label:"Demander un nouveau lien",onClick:L}),s(m,{color:"white",outline:"",label:"Retour à l'accueil",to:"/"})])]),_:1})])):(v(),_("div",Z,[q.value?(v(),w(r,{key:1,class:"bg-positive text-white"},{default:a(()=>[o("div",ee,[s(c,{name:"check_circle",size:"md",class:"q-mr-md"}),e[7]||(e[7]=o("div",{class:"text-h6"},"Mot de passe modifié avec succès!",-1))]),e[8]||(e[8]=o("p",{class:"q-mb-md"},"Votre mot de passe a bien été réinitialisé. Vous pouvez maintenant vous connecter avec vos nouveaux identifiants.",-1)),s(m,{color:"white","text-color":"positive",label:"Se connecter",onClick:P,flat:""})]),_:1})):(v(),w(r,{key:0},{default:a(()=>[e[6]||(e[6]=o("p",{class:"text-body1 q-mb-lg text-grey-8"}," Veuillez définir un nouveau mot de passe sécurisé pour votre compte. ",-1)),s(I,{onSubmit:S(U,["prevent"]),class:"q-gutter-md"},{default:a(()=>[s(k,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value=t),type:"password",label:"Nouveau mot de passe",rules:[t=>!!t||"Le mot de passe est requis",t=>t.length>=8||"Le mot de passe doit contenir au moins 8 caractères"],class:"q-mb-md",outlined:"",square:""},{prepend:a(()=>[s(c,{name:"lock"})]),_:1},8,["modelValue","rules"]),s(k,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=t=>b.value=t),type:"password",label:"Confirmer le mot de passe",rules:[t=>!!t||"La confirmation est requise",t=>t===u.value||"Les mots de passe ne correspondent pas"],class:"q-mb-lg",outlined:"",square:""},{prepend:a(()=>[s(c,{name:"lock_outline"})]),_:1},8,["modelValue","rules"]),o("div",null,[s(m,{label:"Réinitialiser mon mot de passe",type:"submit",color:"primary",class:"full-width",loading:p.value},null,8,["loading"])])]),_:1})]),_:1}))])),!q.value&&!d.value?(v(),w(r,{key:2,class:"bg-grey-2 text-grey-8"},{default:a(()=>[o("div",se,[s(c,{name:"info",size:"xs",class:"q-mr-xs"}),e[9]||(e[9]=h(" Pour votre sécurité, choisissez un mot de passe fort contenant au moins 8 caractères, incluant des lettres majuscules, minuscules, des chiffres et des caractères spéciaux. "))])]),_:1})):B("",!0)]),_:1})])]),s(T,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=t=>f.value=t)},{default:a(()=>[s(C,{style:{"min-width":"350px"}},{default:a(()=>[s(r,{class:"bg-primary text-white"},{default:a(()=>e[10]||(e[10]=[o("div",{class:"text-h6"},"Demander un nouveau lien",-1)])),_:1}),s(r,{class:"q-pt-lg"},{default:a(()=>[e[11]||(e[11]=o("p",{class:"q-mb-md"},"Veuillez entrer votre adresse email pour recevoir un nouveau lien de réinitialisation.",-1)),s(k,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=t=>y.value=t),label:"Email",outlined:"",square:"",type:"email"},{prepend:a(()=>[s(c,{name:"email"})]),_:1},8,["modelValue"])]),_:1}),s(j,{align:"right",class:"bg-white"},{default:a(()=>[M(s(m,{flat:"",label:"Annuler",color:"negative"},null,512),[[J]]),s(m,{flat:"",label:"Envoyer",color:"primary",onClick:E,loading:x.value},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{re as default};
